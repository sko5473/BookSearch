<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTO Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kwang.ho.mapper.BoardMapper">

    <!-- 게시판 목록 조회 -->
    <select id="selectBoardListWithPaging" parameterType="kwang.ho.board.PagingVO" resultType="kwang.ho.board.BoardDto">
		<![CDATA[
		SELECT bid, title, creator_Id, hit_cnt, CREATED_DATETIME
        FROM (
       		SELECT /*+ INDEX_DESC(T_BOARD PK_T_BOARD)*/
        	rownum rn, BID, title, creator_Id, hit_cnt, CREATED_DATETIME
        	FROM t_board
        )
        where rn between #{start} and #{end}
		]]>
    </select>

	<select id="selectBoardTotalCount" resultType="int">
		SELECT COUNT(*)
		FROM T_BOARD
	</select>

	<insert id="insertBoard" parameterType="kwang.ho.board.BoardDto">
		<![CDATA[
			INSERT INTO t_board
			(
				bid, title, contents, created_datetime,creator_id
			)
			VALUES
			(
				kwang_seq.nextval,
				#{title},
				#{contents},
				sysdate,
				'kim'
			)
		]]>
	</insert>

	<update id="updateHitCount" parameterType="int">
		<![CDATA[
			UPDATE T_BOARD
			SET HIT_CNT = HIT_CNT+1
			WHERE bid=#{bid}
		]]>
	</update>

	<select id="selectBoardDetail" parameterType="int" resultType="kwang.ho.board.BoardDto" >
		<![CDATA[
			SELECT bid, title, contents, hit_cnt, TO_CHAR(created_datetime, 'YYYY-MM-DD HH24:MI:SS') AS createdDatetime, creator_id
			FROM t_board
			WHERE bid=#{bid} AND deleted_YN='N'
		 ]]>
	</select>

	<delete id="boardDelete" parameterType="int">
		<![CDATA[
			DELETE FROM T_BOARD
			WHERE bid=#{bid}
		 ]]>
	</delete>

	<update id="boardModify" parameterType="kwang.ho.board.BoardDto" >
		<![CDATA[
			UPDATE
				T_BOARD
			SET
				TITLE=#{title},
				CONTENTS=#{contents},
				UPDATED_DATETIME=SYSDATE,
				UPDATER_ID='KIM'
			WHERE
				bid = #{bid}
		]]>
	</update>

	<select id="selectOpenBoardModify" parameterType="int" resultType="kwang.ho.board.BoardDto" >
		<![CDATA[
			SELECT bid, title, contents, hit_cnt, TO_CHAR(created_datetime, 'YYYY-MM-DD HH24:MI:SS') AS createdDatetime, creator_id
			FROM t_board
			WHERE bid=#{bid} AND deleted_YN='N'
		 ]]>
	</select>
</mapper>